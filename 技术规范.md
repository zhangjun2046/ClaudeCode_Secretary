# ClaudeCode_Secretary æŠ€æœ¯è§„èŒƒ

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜ä¸‰ä¸ªagentçš„å®Œæ•´æŠ€æœ¯å®ç°ç»†èŠ‚ã€‚

---

## Agent 1: æ–°é—»å¼  (News Zhang)

### åŸºæœ¬ä¿¡æ¯
- **Agent ID**: `news-zhang`
- **è§¦å‘è¯**: "æ—©ä¸Šå¥½"
- **è§’è‰²å®šä½**: æ™¨é—´æ–°é—»åŠ©ç†ï¼Œæä¾›AI/é‡‘è/è‚¡å¸‚èµ„è®¯

### æŠ€æœ¯å®ç°ç»†èŠ‚

#### 1. è§¦å‘æœºåˆ¶
```yaml
è§¦å‘æ–¹å¼: Claude Code Slash Command
å‘½ä»¤æ–‡ä»¶: .claude/commands/æ—©ä¸Šå¥½.md
è§¦å‘æ¡ä»¶: ç”¨æˆ·è¾“å…¥ "æ—©ä¸Šå¥½" æˆ– /æ—©ä¸Šå¥½
```

#### 2. æ–°é—»æœç´¢ç­–ç•¥

**AIé¢†åŸŸæ–°é—»**:
```
æœç´¢å…³é”®è¯:
- "å¤§æ¨¡å‹" OR "LLM" OR "GPT" OR "Claude" OR "ChatGPT"
- "äººå·¥æ™ºèƒ½" AND ("åº”ç”¨" OR "çªç ´" OR "å‘å¸ƒ")
- "AIå·¥å…·" OR "AI Agent"

æ—¶é—´èŒƒå›´: æœ€è¿‘24å°æ—¶
æ•°é‡é™åˆ¶: 3-5æ¡
æ¥æºä¼˜å…ˆçº§:
1. æœºå™¨ä¹‹å¿ƒã€é‡å­ä½ã€æ–°æ™ºå…ƒï¼ˆä¸­æ–‡ï¼‰
2. TechCrunch, The Verge, VentureBeatï¼ˆè‹±æ–‡ï¼‰
3. Twitter/X æŠ€æœ¯KOLåŠ¨æ€
```

**é‡‘èå¸‚åœºæ–°é—»**:
```
æœç´¢å…³é”®è¯:
- "å¤®è¡Œ" OR "è´§å¸æ”¿ç­–" OR "åˆ©ç‡"
- "ç¾è”å‚¨" OR "Fed" OR "åŠ æ¯" OR "é™æ¯"
- "äººæ°‘å¸æ±‡ç‡" OR "ç¾å…ƒæŒ‡æ•°"
- "é»„é‡‘" OR "åŸæ²¹" OR "å¤§å®—å•†å“"

æ—¶é—´èŒƒå›´: æœ€è¿‘24å°æ—¶
æ•°é‡é™åˆ¶: 3-5æ¡
æ¥æºä¼˜å…ˆçº§:
1. è´¢è”ç¤¾ã€ç¬¬ä¸€è´¢ç»ã€åå°”è¡—è§é—»
2. Bloomberg, Reuters, CNBC
3. å„å›½å¤®è¡Œå®˜ç½‘å…¬å‘Š
```

**è‚¡å¸‚åŠ¨æ€**:
```
æœç´¢å…³é”®è¯:
- "Aè‚¡" OR "ä¸Šè¯æŒ‡æ•°" OR "æ·±è¯æˆæŒ‡" OR "åˆ›ä¸šæ¿"
- "ç¾è‚¡" OR "çº³æ–¯è¾¾å…‹" OR "æ ‡æ™®500" OR "é“ç¼æ–¯"
- "æ¸¯è‚¡" OR "æ’ç”ŸæŒ‡æ•°"
- çƒ­é—¨æ¿å—: "ç§‘æŠ€è‚¡" "æ–°èƒ½æº" "åŠå¯¼ä½“" "åŒ»è¯"

æ—¶é—´èŒƒå›´: æœ€è¿‘24å°æ—¶
æ•°é‡é™åˆ¶: 3-5æ¡
æ¥æºä¼˜å…ˆçº§:
1. ä¸œæ–¹è´¢å¯Œã€åŒèŠ±é¡ºã€é›ªçƒ
2. MarketWatch, Yahoo Finance
3. åˆ¸å•†ç ”æŠ¥æ ‡é¢˜
```

#### 3. æ–°é—»å¤„ç†æµç¨‹

```mermaid
graph TD
    A[æ¥æ”¶"æ—©ä¸Šå¥½"è§¦å‘] --> B[å¹¶è¡Œæœç´¢ä¸‰ç±»æ–°é—»]
    B --> C1[AIæ–°é—»æœç´¢]
    B --> C2[é‡‘èæ–°é—»æœç´¢]
    B --> C3[è‚¡å¸‚æ–°é—»æœç´¢]
    C1 --> D[å»é‡å’Œè¿‡æ»¤]
    C2 --> D
    C3 --> D
    D --> E[å†…å®¹æ‘˜è¦ç”Ÿæˆ]
    E --> F[ç”ŸæˆMarkdownæ–‡æ¡£]
    F --> G[åˆ›å»ºæ—¥æœŸæ–‡ä»¶å¤¹]
    G --> H[ä¿å­˜æ–‡ä»¶]
    H --> I[å‘é€é£ä¹¦é€šçŸ¥]
```

#### 4. æ–°é—»è¿‡æ»¤è§„åˆ™

**å»é‡é€»è¾‘**:
- æ ‡é¢˜ç›¸ä¼¼åº¦ > 80% â†’ ä¿ç•™æœ€æ–°çš„ä¸€æ¡
- åŒä¸€äº‹ä»¶ä¸åŒæŠ¥é“ â†’ åˆå¹¶æ‘˜è¦ï¼Œæ ‡æ³¨å¤šä¸ªæ¥æº

**è´¨é‡è¿‡æ»¤**:
- æ’é™¤: å¹¿å‘Šã€è½¯æ–‡ã€ä½è´¨é‡è‡ªåª’ä½“
- ä¼˜å…ˆ: å®˜æ–¹æ¥æºã€æƒå¨åª’ä½“ã€æ•°æ®æŠ¥å‘Š
- å¿…é¡»åŒ…å«: æ—¶é—´ã€æ¥æºã€æœ‰æ•ˆé“¾æ¥

**è¯­è¨€å¤„ç†**:
- è‹±æ–‡æ–°é—» â†’ è‡ªåŠ¨ç¿»è¯‘å…³é”®ä¿¡æ¯ä¸ºä¸­æ–‡
- ä¿ç•™åŸæ–‡é“¾æ¥ä¾›è¯¦ç»†é˜…è¯»

#### 5. è¾“å‡ºæ ¼å¼è§„èŒƒ

```markdown
# YYYY-MM-DD ä»Šæ—¥æ–°é—»ç®€æŠ¥

> ğŸ• ç”Ÿæˆæ—¶é—´: HH:MM
> ğŸ“° æ–°é—»æ€»æ•°: Xæ¡

---

## ğŸ¤– AIé¢†åŸŸ

### [æ ‡é¢˜1]
**æ¥æº**: æ¥æºåç§° | **æ—¶é—´**: HH:MM
**æ‘˜è¦**: 100å­—ä»¥å†…çš„æ ¸å¿ƒå†…å®¹æ€»ç»“
**å…³é”®è¯**: #æ ‡ç­¾1 #æ ‡ç­¾2
**é“¾æ¥**: [é˜…è¯»åŸæ–‡](URL)

---

### [æ ‡é¢˜2]
...

---

## ğŸ’° é‡‘èå¸‚åœº

### [æ ‡é¢˜]
**æ¥æº**: | **æ—¶é—´**:
**æ‘˜è¦**:
**å½±å“åˆ†æ**: å¯¹å¸‚åœºçš„æ½œåœ¨å½±å“ï¼ˆ30å­—ä»¥å†…ï¼‰
**é“¾æ¥**: [é˜…è¯»åŸæ–‡](URL)

---

## ğŸ“ˆ è‚¡å¸‚åŠ¨æ€

### Aè‚¡å¸‚åœº
- **ä¸Šè¯æŒ‡æ•°**: XXXXç‚¹ (Â±X.XX%)
- **æ·±è¯æˆæŒ‡**: XXXXç‚¹ (Â±X.XX%)
- **çƒ­ç‚¹æ¿å—**: XXXæ¿å—é¢†æ¶¨/é¢†è·Œ

### å…¨çƒå¸‚åœº
- **ç¾è‚¡**: ...
- **æ¸¯è‚¡**: ...

### é‡ç‚¹æ–°é—»
[æ ‡é¢˜] æ‘˜è¦ | æ¥æº | [é“¾æ¥]

---

## ğŸ¯ ä»Šæ—¥å°ç»“

[AIç”Ÿæˆçš„ç»¼åˆåˆ†æï¼Œ200-300å­—]
- ä»Šæ—¥æ ¸å¿ƒä¸»é¢˜
- å¸‚åœºæƒ…ç»ªåˆ¤æ–­
- å€¼å¾—å…³æ³¨çš„è¶‹åŠ¿
```

#### 6. é£ä¹¦é€šçŸ¥æ ¼å¼

**æ¶ˆæ¯ç±»å‹**: Interactive Card (å¯Œæ–‡æœ¬å¡ç‰‡)

**å¡ç‰‡ç»“æ„**:
```json
{
  "msg_type": "interactive",
  "card": {
    "header": {
      "title": {
        "content": "ğŸ“° ä»Šæ—¥æ–°é—»ç®€æŠ¥",
        "tag": "plain_text"
      },
      "template": "blue"
    },
    "elements": [
      {
        "tag": "div",
        "text": {
          "content": "ğŸ¤– AIé¢†åŸŸ: Xæ¡ | ğŸ’° é‡‘è: Xæ¡ | ğŸ“ˆ è‚¡å¸‚: Xæ¡",
          "tag": "plain_text"
        }
      },
      {
        "tag": "hr"
      },
      {
        "tag": "div",
        "text": {
          "content": "[æ–°é—»ç²¾é€‰æ‘˜è¦ï¼Œä¸è¶…è¿‡200å­—]",
          "tag": "lark_md"
        }
      },
      {
        "tag": "action",
        "actions": [
          {
            "tag": "button",
            "text": {
              "content": "æŸ¥çœ‹å®Œæ•´æŠ¥å‘Š",
              "tag": "plain_text"
            },
            "url": "feishu://doc/[æ–‡æ¡£é“¾æ¥]",
            "type": "default"
          }
        ]
      }
    ]
  }
}
```

#### 7. é”™è¯¯å¤„ç†

**ç½‘ç»œé”™è¯¯**:
- æœç´¢è¶…æ—¶(>30s) â†’ ä½¿ç”¨ç¼“å­˜çš„çƒ­é—¨æ–°é—»
- APIé™æµ â†’ é™çº§ä½¿ç”¨RSSæº

**å†…å®¹ç¼ºå¤±**:
- æŸç±»æ–°é—» < 3æ¡ â†’ æ ‡æ³¨"ä»Šæ—¥è¯¥é¢†åŸŸè¾ƒä¸ºå¹³é™"
- å…¨éƒ¨æœç´¢å¤±è´¥ â†’ ç”Ÿæˆæœ€å°åŒ–æŠ¥å‘Š + é”™è¯¯æ—¥å¿—

**ç”Ÿæˆå¤±è´¥**:
- ä¿å­˜åˆ° `error_logs/YYYY-MM-DD_news_error.log`
- å‘é€ç®€åŒ–ç‰ˆé£ä¹¦é€šçŸ¥è¯´æ˜æƒ…å†µ

#### 8. é…ç½®æ–‡ä»¶

**config/news_agent_config.json**:
```json
{
  "agent_name": "æ–°é—»å¼ ",
  "trigger_phrase": ["æ—©ä¸Šå¥½", "morning"],
  "search_config": {
    "ai_news": {
      "keywords": ["å¤§æ¨¡å‹", "LLM", "ChatGPT", "AI Agent"],
      "max_results": 5,
      "time_range": "24h",
      "sources": ["æœºå™¨ä¹‹å¿ƒ", "é‡å­ä½", "TechCrunch"]
    },
    "finance_news": {
      "keywords": ["å¤®è¡Œ", "è´§å¸æ”¿ç­–", "ç¾è”å‚¨", "æ±‡ç‡"],
      "max_results": 5,
      "time_range": "24h",
      "sources": ["è´¢è”ç¤¾", "Bloomberg", "Reuters"]
    },
    "stock_news": {
      "keywords": ["Aè‚¡", "ä¸Šè¯æŒ‡æ•°", "çº³æ–¯è¾¾å…‹", "æ’ç”ŸæŒ‡æ•°"],
      "max_results": 5,
      "time_range": "24h",
      "sources": ["ä¸œæ–¹è´¢å¯Œ", "Yahoo Finance"]
    }
  },
  "output_config": {
    "folder_pattern": "daily_records/{YYYY-MM-DD}/",
    "filename": "ä»Šæ—¥æ–°é—».md",
    "max_summary_length": 100,
    "language": "zh-CN"
  },
  "feishu_config": {
    "webhook_url": "${FEISHU_WEBHOOK_URL}",
    "notify_enabled": true,
    "card_color": "blue"
  },
  "cache_config": {
    "enable_cache": true,
    "cache_ttl": 3600
  }
}
```

---

## Agent 2: æ•™ç»ƒå¼  (Coach Zhang)

### åŸºæœ¬ä¿¡æ¯
- **Agent ID**: `coach-zhang`
- **è§¦å‘è¯**: "è‡ªå¾‹"
- **è§’è‰²å®šä½**: å¥åº·æ•™ç»ƒï¼Œä½“é‡ç®¡ç†å’Œç”Ÿæ´»æ–¹å¼å»ºè®®

### æŠ€æœ¯å®ç°ç»†èŠ‚

#### 1. è§¦å‘æœºåˆ¶
```yaml
è§¦å‘æ–¹å¼: Claude Code Slash Command
å‘½ä»¤æ–‡ä»¶: .claude/commands/è‡ªå¾‹.md
è§¦å‘æ¡ä»¶: ç”¨æˆ·è¾“å…¥ "è‡ªå¾‹" æˆ– /è‡ªå¾‹
```

#### 2. å¯¹è¯æµç¨‹è®¾è®¡

```mermaid
graph TD
    A[æ¥æ”¶"è‡ªå¾‹"è§¦å‘] --> B[é—®å€™: ä»Šå¤©å¤šå°‘æ–¤?]
    B --> C[è·å–ä½“é‡è¾“å…¥]
    C --> D[è¯»å– about_me.md]
    D --> E[è¯»å– health_history.md]
    E --> F[è®¡ç®—ä½“é‡å˜åŒ–è¶‹åŠ¿]
    F --> G{ä½“é‡å˜åŒ–æƒ…å†µ}
    G -->|ä¸‹é™| H[ç”Ÿæˆé¼“åŠ±+ç»´æŒå»ºè®®]
    G -->|ä¸Šå‡| I[ç”Ÿæˆæ¿€åŠ±+åŠ å¼ºå»ºè®®]
    G -->|å¹³ç¨³| J[ç”ŸæˆåšæŒ+ä¼˜åŒ–å»ºè®®]
    H --> K[ç”Ÿæˆè¿åŠ¨è®¡åˆ’]
    I --> K
    J --> K
    K --> L[ç”Ÿæˆé¥®é£Ÿå»ºè®®]
    L --> M[ä¿å­˜å¥åº·.md]
    M --> N[æ›´æ–° about_me.md]
    N --> O[æ›´æ–° health_history.md]
```

#### 3. æ•°æ®ç»“æ„è®¾è®¡

**context/about_me.md** (ç”¨æˆ·æ¡£æ¡ˆ):
```markdown
# å…³äºæˆ‘

## åŸºæœ¬ä¿¡æ¯
- å§“å: å¼ ä¿Š
- å¹´é¾„: [å¹´é¾„]
- èº«é«˜: [èº«é«˜] cm
- æ€§åˆ«: ç”·

## å¥åº·ç›®æ ‡
- ç›®æ ‡ä½“é‡: XX.X kg
- ç›®æ ‡è¾¾æˆæ—¥æœŸ: YYYY-MM-DD
- å‘¨å‡é‡ç›®æ ‡: 0.5-1 kg/å‘¨

## è¿åŠ¨åå¥½
- å–œæ¬¢çš„è¿åŠ¨: è·‘æ­¥ã€å¥èº«ã€æ¸¸æ³³
- ä¸å–œæ¬¢çš„è¿åŠ¨: [åˆ—è¡¨]
- è¿åŠ¨æ—¶é—´åå¥½: æ—©ä¸Š/æ™šä¸Š
- å¯ç”¨è¿åŠ¨æ—¶é•¿: XXåˆ†é’Ÿ/å¤©

## é¥®é£Ÿåå¥½
- å£å‘³åå¥½: æ¸…æ·¡/é‡å£å‘³/é€‚ä¸­
- é¥®é£Ÿé™åˆ¶: æ— /è¿‡æ•/å®—æ•™
- å–œæ¬¢çš„èœç³»: å·èœã€ç²¤èœã€æ—¥æ–™
- ä¸å–œæ¬¢çš„é£Ÿç‰©: [åˆ—è¡¨]
- æ¯æ—¥çƒ­é‡ç›®æ ‡: XXXX kcal

## å½“å‰çŠ¶æ€
- æœ€æ–°ä½“é‡: XX.X kg (YYYY-MM-DD)
- BMI: XX.X
- ä½“é‡çŠ¶æ€: è¶…é‡/æ­£å¸¸/åç˜¦
```

**context/health_history.md** (å†å²è®°å½•):
```markdown
# å¥åº·å†å²è®°å½•

## ä½“é‡è®°å½•
| æ—¥æœŸ | ä½“é‡(kg) | è¾ƒå‰æ—¥ | è¾ƒå‘¨å¹³å‡ | å¤‡æ³¨ |
|------|---------|--------|----------|------|
| 2025-01-19 | XX.X | -0.2 | -0.5 | åšæŒè¿åŠ¨ |
| 2025-01-18 | XX.X | +0.1 | -0.3 | å¤–å‡ºèšé¤ |
| ... | ... | ... | ... | ... |

## è¿åŠ¨è®°å½•
| æ—¥æœŸ | è¿åŠ¨ç±»å‹ | æ—¶é•¿(åˆ†é’Ÿ) | å¼ºåº¦ | æ¶ˆè€—(kcal) |
|------|---------|-----------|------|-----------|
| 2025-01-19 | è·‘æ­¥ | 30 | ä¸­ | ~300 |
| ... | ... | ... | ... | ... |

## è¶‹åŠ¿åˆ†æ
- 7æ—¥å¹³å‡ä½“é‡: XX.X kg
- 30æ—¥å¹³å‡ä½“é‡: XX.X kg
- è·ç¦»ç›®æ ‡: XX.X kg
- é¢„è®¡è¾¾æˆæ—¥æœŸ: YYYY-MM-DD
```

#### 4. ç®—æ³•è®¾è®¡

**ä½“é‡å˜åŒ–åˆ†æ**:
```python
def analyze_weight_trend(current_weight, history):
    """
    åˆ†æä½“é‡å˜åŒ–è¶‹åŠ¿
    """
    # è®¡ç®—æ—¥å˜åŒ–
    daily_change = current_weight - history[-1]['weight']

    # è®¡ç®—7æ—¥å¹³å‡
    week_avg = sum([d['weight'] for d in history[-7:]]) / 7
    week_change = current_weight - week_avg

    # è®¡ç®—å˜åŒ–ç‡
    change_rate = (daily_change / history[-1]['weight']) * 100

    # åˆ¤æ–­è¶‹åŠ¿
    if week_change < -0.5:
        trend = "è‰¯å¥½ä¸‹é™"
        advice_type = "ç»´æŒå‹"
    elif week_change < -0.2:
        trend = "ç¨³å®šä¸‹é™"
        advice_type = "ç»´æŒå‹"
    elif abs(week_change) <= 0.2:
        trend = "åŸºæœ¬æŒå¹³"
        advice_type = "åŠ å¼ºå‹"
    elif week_change < 0.5:
        trend = "å°å¹…ä¸Šå‡"
        advice_type = "å¼ºåŒ–å‹"
    else:
        trend = "æ˜æ˜¾ä¸Šå‡"
        advice_type = "å¼ºåŒ–å‹"

    return {
        'daily_change': daily_change,
        'week_change': week_change,
        'trend': trend,
        'advice_type': advice_type
    }
```

**è¿åŠ¨å»ºè®®ç”Ÿæˆ**:
```python
def generate_exercise_plan(weight_trend, user_profile):
    """
    åŸºäºä½“é‡è¶‹åŠ¿å’Œç”¨æˆ·åå¥½ç”Ÿæˆè¿åŠ¨è®¡åˆ’
    """
    advice_type = weight_trend['advice_type']
    preferences = user_profile['exercise_preferences']

    if advice_type == "ç»´æŒå‹":
        intensity = "ä¸­ç­‰"
        duration = 30  # åˆ†é’Ÿ
        exercises = preferences['favorite']  # ç”¨æˆ·å–œæ¬¢çš„è¿åŠ¨
    elif advice_type == "åŠ å¼ºå‹":
        intensity = "ä¸­é«˜"
        duration = 40
        exercises = mix_exercises(preferences)  # æ··åˆè¿åŠ¨
    elif advice_type == "å¼ºåŒ–å‹":
        intensity = "é«˜"
        duration = 50
        exercises = high_intensity_exercises(preferences)

    return {
        'type': exercises,
        'duration': duration,
        'intensity': intensity,
        'calories': estimate_calories(exercises, duration, intensity)
    }
```

**é¥®é£Ÿå»ºè®®ç®—æ³•**:
```python
def generate_meal_plan(weight_trend, user_profile):
    """
    ç”Ÿæˆä¸ªæ€§åŒ–é¤é¥®å»ºè®®
    """
    daily_calorie_target = calculate_calorie_target(
        current_weight=user_profile['current_weight'],
        target_weight=user_profile['target_weight'],
        activity_level=user_profile['activity_level']
    )

    # ä¸‰é¤çƒ­é‡åˆ†é…: æ—©30% åˆ40% æ™š30%
    breakfast_cal = daily_calorie_target * 0.3
    lunch_cal = daily_calorie_target * 0.4
    dinner_cal = daily_calorie_target * 0.3

    # æ ¹æ®ç”¨æˆ·å£å‘³åå¥½å’Œçƒ­é‡é™åˆ¶æ¨èé¤å…
    meals = {
        'breakfast': recommend_meal(
            calorie_limit=breakfast_cal,
            meal_type='breakfast',
            preferences=user_profile['food_preferences']
        ),
        'lunch': recommend_meal(
            calorie_limit=lunch_cal,
            meal_type='lunch',
            preferences=user_profile['food_preferences']
        ),
        'dinner': recommend_meal(
            calorie_limit=dinner_cal,
            meal_type='dinner',
            preferences=user_profile['food_preferences']
        )
    }

    return meals
```

#### 5. å¤–å–æ¨èæ•°æ®åº“

**restaurants_db.json** (å¤–å–æ•°æ®åº“):
```json
{
  "breakfast": [
    {
      "name": "æ¡‚æ»¡é™‡",
      "dishes": [
        {
          "name": "çš®è›‹ç˜¦è‚‰ç²¥",
          "calories": 180,
          "protein": 8,
          "carbs": 30,
          "fat": 3,
          "price": 15
        },
        {
          "name": "ç´ èœåŒ…",
          "calories": 120,
          "protein": 4,
          "carbs": 22,
          "fat": 2,
          "price": 8
        }
      ]
    }
  ],
  "lunch": [
    {
      "name": "çœŸåŠŸå¤«",
      "dishes": [
        {
          "name": "è’¸é¸¡è…¿é¥­",
          "calories": 520,
          "protein": 35,
          "carbs": 60,
          "fat": 12,
          "tags": ["é«˜è›‹ç™½", "ä½è„‚"],
          "price": 28
        }
      ]
    }
  ],
  "dinner": [
    {
      "name": "å‰é‡å®¶",
      "dishes": [
        {
          "name": "ç‰›è‚‰é¥­(å°ç¢—)",
          "calories": 450,
          "protein": 20,
          "carbs": 55,
          "fat": 15,
          "price": 22
        }
      ]
    }
  ]
}
```

#### 6. è¾“å‡ºæ ¼å¼è§„èŒƒ

```markdown
# YYYY-MM-DD å¥åº·è®¡åˆ’

> ğŸ’ª æ•™ç»ƒå¼ ä¸ºä½ åˆ¶å®šä»Šæ—¥å¥åº·æ–¹æ¡ˆ
> â° ç”Ÿæˆæ—¶é—´: HH:MM

---

## ğŸ“Š ä»Šæ—¥ä½“é‡

| æŒ‡æ ‡ | æ•°å€¼ | è¯´æ˜ |
|------|------|------|
| å½“å‰ä½“é‡ | XX.X kg | |
| ç›®æ ‡ä½“é‡ | XX.X kg | |
| æ—¥å˜åŒ– | Â±X.X kg | è¾ƒæ˜¨æ—¥ |
| å‘¨å˜åŒ– | Â±X.X kg | è¾ƒ7æ—¥å‡å€¼ |
| è·ç¦»ç›®æ ‡ | X.X kg | çº¦éœ€Xå‘¨ |

**è¶‹åŠ¿åˆ†æ**: [è‰¯å¥½ä¸‹é™/ç¨³å®šä¸‹é™/åŸºæœ¬æŒå¹³/å°å¹…ä¸Šå‡/æ˜æ˜¾ä¸Šå‡]

---

## ğŸƒ è¿åŠ¨å»ºè®®

### ä»Šæ—¥æ¨è
- **é¡¹ç›®**: è·‘æ­¥ + åŠ›é‡è®­ç»ƒ
- **æ—¶é•¿**: 40åˆ†é’Ÿ (è·‘æ­¥30åˆ†é’Ÿ + æ‹‰ä¼¸10åˆ†é’Ÿ)
- **å¼ºåº¦**: ä¸­ç­‰
- **é¢„è®¡æ¶ˆè€—**: ~350 kcal
- **æœ€ä½³æ—¶æ®µ**: 18:00-19:00 (æ ¹æ®ä½ çš„ä¹ æƒ¯)

### è¿åŠ¨æ–¹æ¡ˆ
**è·‘æ­¥ (30åˆ†é’Ÿ)**
- çƒ­èº«: 5åˆ†é’Ÿæ…¢è·‘
- ä¸»ä½“: 20åˆ†é’Ÿä¸­é€Ÿè·‘ (é…é€Ÿ6:00/km)
- æ”¾æ¾: 5åˆ†é’Ÿæ…¢è·‘

**æ‹‰ä¼¸ (10åˆ†é’Ÿ)**
- è…¿éƒ¨æ‹‰ä¼¸: 3åˆ†é’Ÿ
- æ ¸å¿ƒæ‹‰ä¼¸: 3åˆ†é’Ÿ
- ä¸Šè‚¢æ‹‰ä¼¸: 2åˆ†é’Ÿ
- æ”¾æ¾å‘¼å¸: 2åˆ†é’Ÿ

### è¿åŠ¨ç›®æ ‡
[æ ¹æ®ä½“é‡è¶‹åŠ¿ç»™å‡ºçš„å…·ä½“ç†ç”±ï¼Œä¾‹å¦‚:]
"æœ¬å‘¨ä½“é‡ä¸‹é™è¶‹åŠ¿è‰¯å¥½,ä»Šå¤©ä¿æŒä¸­ç­‰å¼ºåº¦è¿åŠ¨å³å¯ã€‚æ³¨æ„ä¸è¦è¿‡åº¦è®­ç»ƒå¯¼è‡´ç–²åŠ³ã€‚"

---

## ğŸ½ï¸ é¥®é£Ÿå»ºè®®

> ä»Šæ—¥ç›®æ ‡æ‘„å…¥: ~1800 kcal
> å»ºè®®é…æ¯”: è›‹ç™½è´¨30% | ç¢³æ°´50% | è„‚è‚ª20%

### æ—©é¤ (540 kcal)
**æ¨èæ–¹æ¡ˆä¸€: æ¡‚æ»¡é™‡**
- ğŸ¥£ çš®è›‹ç˜¦è‚‰ç²¥ (180 kcal)
- ğŸ¥Ÿ ç´ èœåŒ… x2 (240 kcal)
- ğŸ¥š æ°´ç…®è›‹ (70 kcal)
- ğŸ¥› æ— ç³–è±†æµ† (50 kcal)
- ğŸ’° é¢„è®¡: Â¥23

**æ¨èæ–¹æ¡ˆäºŒ: è‡ªåˆ¶**
- ç‡•éº¦ç²¥ + é¦™è•‰ + é¸¡è›‹
- ğŸ’° é¢„è®¡: Â¥10

---

### åˆé¤ (720 kcal)
**æ¨èæ–¹æ¡ˆ: çœŸåŠŸå¤«**
- ğŸ— è’¸é¸¡è…¿é¥­ (520 kcal)
- ğŸ¥— ç´ èœæ‹¼ç›˜ (150 kcal)
- ğŸµ æ— ç³–èŒ¶é¥® (0 kcal)
- ğŸ’° é¢„è®¡: Â¥35

**è¥å…»åˆ†æ**:
- è›‹ç™½è´¨: 40g (å……è¶³)
- ç¢³æ°´: 65g (é€‚ä¸­)
- è„‚è‚ª: 18g (ä½è„‚)
- âœ… é«˜è›‹ç™½ã€ä½è„‚è‚ª,é€‚åˆå‡é‡æœŸ

**æ›¿ä»£æ–¹æ¡ˆ**:
å¦‚æœä¸æƒ³åƒé¸¡è…¿é¥­,å¯ä»¥é€‰æ‹©"å‰é‡å®¶ç‰›è‚‰é¥­(å°ç¢—)"(450 kcal)

---

### æ™šé¤ (540 kcal)
**æ¨èæ–¹æ¡ˆ: æ²™æ‹‰è½»é£Ÿ**
- ğŸ¥— é¸¡èƒ¸è‚‰æ²™æ‹‰ (350 kcal)
- ğŸ  è’¸çº¢è–¯ (150 kcal)
- ğŸ’§ æ°”æ³¡æ°´ (0 kcal)
- ğŸ’° é¢„è®¡: Â¥30

**å»ºè®®**:
æ™šé¤å°½é‡æ¸…æ·¡,é¿å…é«˜ç¢³æ°´é«˜è„‚è‚ªã€‚å¦‚æœè¿åŠ¨åå¾ˆé¥¿,å¯ä»¥å¢åŠ ä¸€ä»½æ°´æœã€‚

---

### åŠ é¤ (å¯é€‰)
**ä¸‹åˆèŒ¶ (3pm)**
- ğŸ è‹¹æœ/é¦™è•‰ (~100 kcal)
- æˆ–
- ğŸ¥œ åšæœå°åŒ… (~150 kcal)

---

## ğŸ’§ é¥®æ°´æé†’
- **ç›®æ ‡**: 2000-2500 ml/å¤©
- **å»ºè®®**: èµ·åºŠåã€ä¸‰é¤å‰ã€è¿åŠ¨ä¸­éƒ½è¦è¡¥æ°´
- **æ—¶é—´è¡¨**:
  - 07:00 èµ·åºŠ â†’ 300ml æ¸©æ°´
  - 10:00 ä¸Šåˆ â†’ 200ml
  - 12:00 åˆé¤å‰ â†’ 200ml
  - 15:00 ä¸‹åˆ â†’ 200ml
  - 18:00 è¿åŠ¨ä¸­ â†’ 300ml
  - 19:30 æ™šé¤å‰ â†’ 200ml
  - 21:00 ç¡å‰1h â†’ 200ml

---

## ğŸ“ ä»Šæ—¥å¯„è¯­

[æ ¹æ®ä½“é‡è¶‹åŠ¿ç”Ÿæˆçš„ä¸ªæ€§åŒ–æ¿€åŠ±è¯è¯­]

**è‰¯å¥½è¶‹åŠ¿ç¤ºä¾‹**:
"ğŸ’ª å¹²å¾—å¥½!æœ¬å‘¨ä½“é‡ä¸‹é™0.8kg,è¯´æ˜ä½ çš„åŠªåŠ›æœ‰äº†å›æŠ¥ã€‚ç»§ç»­ä¿æŒè¿™ä¸ªèŠ‚å¥,é¢„è®¡3å‘¨åå¯ä»¥è¾¾åˆ°é˜¶æ®µæ€§ç›®æ ‡ã€‚è®°ä½:å¥åº·å‡é‡æ˜¯ä¸€åœºé©¬æ‹‰æ¾,ä¸æ˜¯ç™¾ç±³å†²åˆº!"

**éœ€è¦åŠ å¼ºç¤ºä¾‹**:
"ğŸ”¥ è¿™å‘¨ä½“é‡æœ‰å°å¹…æ³¢åŠ¨,ä¸è¦æ°”é¦!ä½“é‡ç®¡ç†æœ¬æ¥å°±ä¸æ˜¯ä¸€å¸†é£é¡ºçš„ã€‚ä»Šå¤©åŠ å¼ºä¸€ç‚¹è¿åŠ¨å¼ºåº¦,ä¸¥æ ¼æ§åˆ¶é¥®é£Ÿ,ç›¸ä¿¡æ˜å¤©çš„ä½ ä¼šæ„Ÿè°¢ä»Šå¤©çš„åšæŒ!"

---

## ğŸ“ˆ é•¿æœŸè¿½è¸ª

**æœ¬å‘¨æ¦‚è§ˆ** (YYYY-MM-DD è‡³ YYYY-MM-DD)
- å‘¨åˆä½“é‡: XX.X kg
- å‘¨æœ«ä½“é‡: XX.X kg
- å‘¨å˜åŒ–: -X.X kg âœ…
- å‘¨è¿åŠ¨: Xå¤©,å…±XXXåˆ†é’Ÿ
- ç›®æ ‡å®Œæˆåº¦: XX%

**æœˆåº¦ç›®æ ‡**
- æœˆåˆ: XX.X kg
- æœˆæœ«ç›®æ ‡: XX.X kg (-2kg)
- å½“å‰è¿›åº¦: X.X kg / 2kg (XX%)
- é¢„è®¡å®Œæˆ: [èƒ½/ä¸èƒ½]å¦‚æœŸå®Œæˆ

---

_ğŸ¤– æœ¬è®¡åˆ’ç”±æ•™ç»ƒå¼ åŸºäºä½ çš„å¥åº·æ•°æ®å’Œå†å²è®°å½•ç”Ÿæˆ_
_å¦‚æœ‰èº«ä½“ä¸é€‚æˆ–ç‰¹æ®Šæƒ…å†µ,è¯·åŠæ—¶è°ƒæ•´è®¡åˆ’æˆ–å’¨è¯¢åŒ»ç”Ÿ_
```

#### 7. æ•°æ®æ›´æ–°é€»è¾‘

**æ›´æ–° about_me.md**:
```python
def update_about_me(new_weight, date):
    """
    æ›´æ–°ç”¨æˆ·æ¡£æ¡ˆä¸­çš„æœ€æ–°ä½“é‡
    """
    # è¯»å–ç°æœ‰æ¡£æ¡ˆ
    profile = read_markdown('context/about_me.md')

    # æ›´æ–°"å½“å‰çŠ¶æ€"éƒ¨åˆ†
    profile['current_status']['latest_weight'] = {
        'weight': new_weight,
        'date': date,
        'bmi': calculate_bmi(new_weight, profile['height'])
    }

    # ä¿å­˜æ›´æ–°
    write_markdown('context/about_me.md', profile)
```

**æ›´æ–° health_history.md**:
```python
def update_health_history(weight_data, exercise_data):
    """
    è¿½åŠ æ–°è®°å½•åˆ°å¥åº·å†å²
    """
    history = read_markdown('context/health_history.md')

    # è¿½åŠ ä½“é‡è®°å½•
    history['weight_records'].append({
        'date': weight_data['date'],
        'weight': weight_data['weight'],
        'daily_change': weight_data['daily_change'],
        'week_avg_change': weight_data['week_change'],
        'note': weight_data.get('note', '')
    })

    # è¿½åŠ è¿åŠ¨è®°å½•
    history['exercise_records'].append({
        'date': exercise_data['date'],
        'type': exercise_data['type'],
        'duration': exercise_data['duration'],
        'intensity': exercise_data['intensity'],
        'calories': exercise_data['calories']
    })

    # é‡æ–°è®¡ç®—è¶‹åŠ¿
    history['trend_analysis'] = recalculate_trends(history)

    # ä¿å­˜
    write_markdown('context/health_history.md', history)
```

#### 8. é…ç½®æ–‡ä»¶

**config/coach_agent_config.json**:
```json
{
  "agent_name": "æ•™ç»ƒå¼ ",
  "trigger_phrase": ["è‡ªå¾‹"],
  "personality": {
    "tone": "é¼“åŠ±ã€ä¸“ä¸šã€æ¸©æš–",
    "style": "ç§äººæ•™ç»ƒ"
  },
  "health_config": {
    "weight_unit": "kg",
    "calorie_unit": "kcal",
    "target_weekly_loss": [0.5, 1.0],
    "min_daily_calories": 1500,
    "max_daily_calories": 2500
  },
  "exercise_config": {
    "intensity_levels": {
      "low": {"duration": 20, "calorie_rate": 5},
      "medium": {"duration": 30, "calorie_rate": 8},
      "high": {"duration": 40, "calorie_rate": 12}
    },
    "exercise_types": [
      {"name": "è·‘æ­¥", "calorie_rate": 10, "difficulty": "medium"},
      {"name": "å¥èº«", "calorie_rate": 8, "difficulty": "medium"},
      {"name": "æ¸¸æ³³", "calorie_rate": 12, "difficulty": "high"},
      {"name": "ç‘œä¼½", "calorie_rate": 4, "difficulty": "low"}
    ]
  },
  "meal_config": {
    "meal_distribution": {
      "breakfast": 0.3,
      "lunch": 0.4,
      "dinner": 0.3
    },
    "restaurants_db_path": "data/restaurants_db.json"
  },
  "output_config": {
    "folder_pattern": "daily_records/{YYYY-MM-DD}/",
    "filename": "å¥åº·.md"
  },
  "data_update": {
    "update_about_me": true,
    "update_health_history": true,
    "history_retention_days": 365
  }
}
```

---

## Agent 3: åæ€å¼  (Reflection Zhang)

### åŸºæœ¬ä¿¡æ¯
- **Agent ID**: `reflection-zhang`
- **è§¦å‘è¯**: "ä»Šå·¥ä½œç»“æŸäº†"
- **è§’è‰²å®šä½**: å·¥ä½œåæ€å¼•å¯¼å¸ˆ,å¸®åŠ©æ·±åº¦æ€è€ƒå’Œè‡ªæˆ‘æˆé•¿

### æŠ€æœ¯å®ç°ç»†èŠ‚

#### 1. è§¦å‘æœºåˆ¶
```yaml
è§¦å‘æ–¹å¼: Claude Code Slash Command
å‘½ä»¤æ–‡ä»¶: .claude/commands/ä»Šå·¥ä½œç»“æŸäº†.md
è§¦å‘æ¡ä»¶:
  - "ä»Šå·¥ä½œç»“æŸäº†"
  - "ä»Šå¤©å·¥ä½œå®Œæˆäº†"
  - "ä¸‹ç­äº†"
  - /åæ€
```

#### 2. å¯¹è¯æµç¨‹è®¾è®¡

```mermaid
graph TD
    A[æ¥æ”¶è§¦å‘è¯] --> B[é—®å€™: è¾›è‹¦äº†,ä»Šå¤©æ€ä¹ˆæ ·?]
    B --> C[ç¬¬1è½®: ä»Šå¤©åšäº†ä»€ä¹ˆ?]
    C --> D[è®°å½•å·¥ä½œå†…å®¹]
    D --> E[ç¬¬2è½®: å“ªäº›æœ‰æˆå°±æ„Ÿ/æŒ‘æˆ˜?]
    E --> F[è¯†åˆ«å…³é”®äº‹ä»¶]
    F --> G[ç¬¬3è½®: ä»Šå¤©çŠ¶æ€å¦‚ä½•?]
    G --> H[åˆ†ææƒ…ç»ªçŠ¶æ€]
    H --> I[ç¬¬4è½®: å­¦åˆ°äº†ä»€ä¹ˆ?]
    I --> J[æå–æ´å¯Ÿ]
    J --> K[ç¬¬5è½®: æ˜å¤©æƒ³æ”¹è¿›ä»€ä¹ˆ?]
    K --> L[è®°å½•æœŸå¾…]
    L --> M[AIæ·±åº¦åˆ†æ]
    M --> N[ç”Ÿæˆåæ€æ–‡æ¡£]
    N --> O[ä¿å­˜åˆ°æ—¥æœŸæ–‡ä»¶å¤¹]
    O --> P[å¯é€‰: æ›´æ–°insights.md]
```

#### 3. å¯¹è¯å¼•å¯¼è¯åº“

**ç¬¬1è½® - å·¥ä½œå†…å®¹æ¢ç´¢**:
```json
{
  "round": 1,
  "goal": "äº†è§£ä»Šå¤©çš„å·¥ä½œå†…å®¹",
  "questions": [
    "ä»Šå¤©ä¸»è¦åšäº†ä»€ä¹ˆå·¥ä½œå‘¢?",
    "èƒ½è·Ÿæˆ‘è¯´è¯´ä»Šå¤©å¿™äº†äº›ä»€ä¹ˆå—?",
    "ä»Šå¤©çš„å·¥ä½œå†…å®¹æœ‰å“ªäº›?"
  ],
  "follow_up": [
    "å¬èµ·æ¥å¾ˆå……å®!è¿˜æœ‰å…¶ä»–äº‹æƒ…å—?",
    "è¿™ä¸ª[å…·ä½“ä»»åŠ¡]èŠ±äº†å¤šé•¿æ—¶é—´?",
    "é™¤äº†è¿™äº›,è¿˜æœ‰éœ€è¦æåˆ°çš„å—?"
  ],
  "extraction_targets": [
    "å·¥ä½œä»»åŠ¡åˆ—è¡¨",
    "æ—¶é—´åˆ†é…",
    "åä½œå¯¹è±¡",
    "å®Œæˆæƒ…å†µ"
  ]
}
```

**ç¬¬2è½® - æƒ…æ„Ÿä½“éªŒæŒ–æ˜**:
```json
{
  "round": 2,
  "goal": "è¯†åˆ«æƒ…æ„Ÿé«˜ç‚¹å’Œä½ç‚¹",
  "questions": [
    "è¿™äº›å·¥ä½œä¸­,å“ªäº›è®©ä½ æ„Ÿåˆ°æœ‰æˆå°±æ„Ÿ?",
    "æœ‰é‡åˆ°ä»€ä¹ˆæŒ‘æˆ˜æˆ–å›°éš¾å—?",
    "ä»Šå¤©æœ‰ä»€ä¹ˆè®©ä½ ç‰¹åˆ«æœ‰æ„Ÿè§¦çš„æ—¶åˆ»?"
  ],
  "follow_up": [
    "ä¸ºä»€ä¹ˆ[è¿™ä»¶äº‹]è®©ä½ æœ‰æˆå°±æ„Ÿ?",
    "è¿™ä¸ªæŒ‘æˆ˜æ˜¯æ€ä¹ˆå‡ºç°çš„?",
    "ä½ å½“æ—¶æ˜¯æ€ä¹ˆå¤„ç†çš„?",
    "ç»“æœå¦‚ä½•?"
  ],
  "extraction_targets": [
    "æˆå°±äº‹ä»¶ + åŸå› ",
    "æŒ‘æˆ˜äº‹ä»¶ + åº”å¯¹æ–¹å¼",
    "æƒ…ç»ªè§¦å‘ç‚¹"
  ]
}
```

**ç¬¬3è½® - çŠ¶æ€è¯„ä¼°**:
```json
{
  "round": 3,
  "goal": "è¯„ä¼°æ•´ä½“çŠ¶æ€å’Œæƒ…ç»ª",
  "questions": [
    "ä½ è§‰å¾—ä»Šå¤©çš„çŠ¶æ€æ€ä¹ˆæ ·?",
    "å·¥ä½œæ—¶çš„ç²¾åŠ›å¦‚ä½•?",
    "æœ‰ä»€ä¹ˆæƒ…ç»ªæ³¢åŠ¨å—?"
  ],
  "follow_up": [
    "æ˜¯ä»€ä¹ˆè®©ä½ æ„Ÿåˆ°[ç–²æƒ«/å…´å¥‹/ç„¦è™‘]?",
    "è¿™ç§æ„Ÿè§‰æŒç»­äº†å¤šä¹…?",
    "æœ‰æ²¡æœ‰å½±å“åˆ°å·¥ä½œæ•ˆç‡?"
  ],
  "extraction_targets": [
    "ç²¾åŠ›æ°´å¹³: 1-10åˆ†",
    "ä¸»å¯¼æƒ…ç»ª: [å…´å¥‹/å¹³é™/ç„¦è™‘/ç–²æƒ«/...]",
    "æƒ…ç»ªè§¦å‘å› ç´ ",
    "å‹åŠ›æ¥æº"
  ]
}
```

**ç¬¬4è½® - å­¦ä¹ æå–**:
```json
{
  "round": 4,
  "goal": "æå–å­¦ä¹ å’Œæˆé•¿ç‚¹",
  "questions": [
    "ä»ä»Šå¤©çš„ç»å†ä¸­,ä½ å­¦åˆ°äº†ä»€ä¹ˆ?",
    "æœ‰ä»€ä¹ˆæ–°çš„è®¤è¯†æˆ–æƒ³æ³•å—?",
    "ä»Šå¤©æœ‰ä»€ä¹ˆå€¼å¾—è®°ä½çš„ç»éªŒ?"
  ],
  "follow_up": [
    "è¿™ä¸ªè®¤è¯†å¯¹ä»¥åçš„å·¥ä½œæœ‰ä»€ä¹ˆå¸®åŠ©?",
    "ä½ æ‰“ç®—æ€ä¹ˆåº”ç”¨è¿™ä¸ªç»éªŒ?",
    "è¿˜æœ‰å…¶ä»–æ”¶è·å—?"
  ],
  "extraction_targets": [
    "æŠ€èƒ½æå‡",
    "è®¤çŸ¥æ›´æ–°",
    "ç»éªŒæ•™è®­",
    "æ–¹æ³•è®º"
  ]
}
```

**ç¬¬5è½® - å‰ç»è§„åˆ’**:
```json
{
  "round": 5,
  "goal": "å±•æœ›æ˜å¤©å’Œæœªæ¥",
  "questions": [
    "æ˜å¤©æœ‰ä»€ä¹ˆæƒ³è¦æ”¹è¿›æˆ–å°è¯•çš„å—?",
    "æœ‰ä»€ä¹ˆäº‹æƒ…æƒ³è¦ç»§ç»­æ¨è¿›?",
    "å¯¹æ˜å¤©æœ‰ä»€ä¹ˆæœŸå¾…?"
  ],
  "follow_up": [
    "å…·ä½“æ‰“ç®—æ€ä¹ˆåš?",
    "éœ€è¦å“ªäº›å‡†å¤‡?",
    "é¢„è®¡ä¼šé‡åˆ°ä»€ä¹ˆå›°éš¾?"
  ],
  "extraction_targets": [
    "æ”¹è¿›è®¡åˆ’",
    "å¾…åŠäº‹é¡¹",
    "æœŸå¾…ç›®æ ‡",
    "æ½œåœ¨é£é™©"
  ]
}
```

#### 4. AIåˆ†ææ¨¡å—

**æƒ…æ„Ÿåˆ†æç®—æ³•**:
```python
def analyze_emotion(dialogue_history):
    """
    åˆ†æå¯¹è¯ä¸­çš„æƒ…ç»ªçŠ¶æ€
    """
    # æƒ…ç»ªå…³é”®è¯è¯å…¸
    emotion_keywords = {
        'positive': ['å¼€å¿ƒ', 'å…´å¥‹', 'æ»¡æ„', 'æˆå°±', 'é¡ºåˆ©', 'çªç ´'],
        'negative': ['ç„¦è™‘', 'ç–²æƒ«', 'å›°éš¾', 'æŒ«æŠ˜', 'å‹åŠ›', 'çƒ¦èº'],
        'neutral': ['å¹³å¸¸', 'ä¸€èˆ¬', 'æ­£å¸¸', 'è¿˜å¥½', 'å¹³é™']
    }

    # ç»Ÿè®¡æƒ…ç»ªè¯é¢‘
    emotion_counts = count_emotion_words(dialogue_history, emotion_keywords)

    # è®¡ç®—æƒ…ç»ªå€¾å‘
    total = sum(emotion_counts.values())
    emotion_distribution = {
        k: (v / total * 100) for k, v in emotion_counts.items()
    }

    # åˆ¤æ–­ä¸»å¯¼æƒ…ç»ª
    dominant_emotion = max(emotion_distribution, key=emotion_distribution.get)

    # æƒ…ç»ªå¼ºåº¦è¯„åˆ† (1-10)
    intensity = calculate_emotion_intensity(dialogue_history)

    return {
        'dominant': dominant_emotion,
        'distribution': emotion_distribution,
        'intensity': intensity,
        'triggers': extract_emotion_triggers(dialogue_history)
    }
```

**å·¥ä½œæ¨¡å¼è¯†åˆ«**:
```python
def identify_work_patterns(current_reflection, historical_data):
    """
    è¯†åˆ«å·¥ä½œæ¨¡å¼å’Œä¹ æƒ¯
    """
    patterns = {
        'time_management': analyze_time_allocation(current_reflection),
        'productivity_rhythm': identify_productivity_peaks(historical_data),
        'stress_triggers': find_common_stressors(historical_data),
        'achievement_sources': find_achievement_patterns(historical_data),
        'collaboration_style': analyze_collaboration(current_reflection)
    }

    return patterns

def analyze_time_allocation(reflection):
    """
    åˆ†ææ—¶é—´åˆ†é…
    """
    tasks = reflection['tasks']
    total_time = sum([t['duration'] for t in tasks])

    allocation = {}
    for task in tasks:
        category = categorize_task(task['description'])
        allocation[category] = allocation.get(category, 0) + task['duration']

    # è®¡ç®—ç™¾åˆ†æ¯”
    allocation_pct = {k: (v/total_time*100) for k, v in allocation.items()}

    return {
        'total_time': total_time,
        'allocation': allocation_pct,
        'dominant_category': max(allocation_pct, key=allocation_pct.get)
    }

def identify_productivity_peaks(history):
    """
    è¯†åˆ«é«˜æ•ˆæ—¶æ®µ
    """
    # åˆ†æå†å²æ•°æ®ä¸­"æœ‰æˆå°±æ„Ÿ"çš„æ—¶é—´æ®µ
    productive_times = []
    for record in history:
        if record['achievements']:
            productive_times.extend(record['work_time_range'])

    # ç»Ÿè®¡é¢‘ç‡
    time_frequency = count_time_frequency(productive_times)

    # æ‰¾å‡ºé«˜é¢‘æ—¶æ®µ
    peak_hours = find_peaks(time_frequency)

    return {
        'peak_hours': peak_hours,
        'suggestion': f"ä½ åœ¨ {peak_hours} æ—¶æ®µé€šå¸¸æ•ˆç‡æœ€é«˜,å»ºè®®æŠŠé‡è¦ä»»åŠ¡å®‰æ’åœ¨è¿™ä¸ªæ—¶é—´"
    }
```

**é•¿æœŸè¶‹åŠ¿åˆ†æ**:
```python
def analyze_long_term_trends(recent_reflections):
    """
    åˆ†æé•¿æœŸè¶‹åŠ¿ (æœ€è¿‘30å¤©)
    """
    trends = {
        'emotion_trend': plot_emotion_curve(recent_reflections),
        'productivity_trend': plot_productivity_curve(recent_reflections),
        'growth_trajectory': identify_growth_areas(recent_reflections),
        'recurring_challenges': find_recurring_issues(recent_reflections)
    }

    # ç”Ÿæˆæ´å¯Ÿ
    insights = []

    # æƒ…ç»ªè¶‹åŠ¿æ´å¯Ÿ
    if trends['emotion_trend']['slope'] < -0.1:
        insights.append({
            'type': 'warning',
            'message': 'æœ€è¿‘ä¸¤å‘¨æƒ…ç»ªå‘ˆä¸‹é™è¶‹åŠ¿,æ³¨æ„ä¼‘æ¯å’Œå‹åŠ›ç®¡ç†'
        })
    elif trends['emotion_trend']['slope'] > 0.1:
        insights.append({
            'type': 'positive',
            'message': 'æœ€è¿‘çŠ¶æ€é€æ¸ä¸Šå‡,ä¿æŒè¿™ä¸ªèŠ‚å¥!'
        })

    # é‡å¤æŒ‘æˆ˜æ´å¯Ÿ
    if trends['recurring_challenges']:
        top_challenge = trends['recurring_challenges'][0]
        insights.append({
            'type': 'suggestion',
            'message': f'"{top_challenge}" è¿™ä¸ªé—®é¢˜å·²ç»å‡ºç°{count}æ¬¡äº†,å»ºè®®å¯»æ‰¾ç³»ç»Ÿæ€§è§£å†³æ–¹æ¡ˆ'
        })

    return {
        'trends': trends,
        'insights': insights
    }
```

#### 5. è¾“å‡ºæ ¼å¼è§„èŒƒ

```markdown
# YYYY-MM-DD å·¥ä½œåæ€

> ğŸŒ™ è¾›è‹¦äº†ä¸€å¤©,è®©æˆ‘ä»¬ä¸€èµ·å›é¡¾ä»Šå¤©çš„æ”¶è·
> â° åæ€æ—¶é—´: HH:MM
> ğŸ“ å¯¹è¯è½®æ¬¡: 5è½®

---

## ğŸ“‹ ä»Šæ—¥å·¥ä½œæ¦‚è§ˆ

### ä¸»è¦ä»»åŠ¡
1. **[ä»»åŠ¡1åç§°]** (è€—æ—¶: Xå°æ—¶)
   - å…·ä½“å†…å®¹: [ä»å¯¹è¯ä¸­æå–]
   - å®Œæˆåº¦: XX%
   - åä½œäºº: [å¦‚æœ‰]

2. **[ä»»åŠ¡2åç§°]** (è€—æ—¶: Xå°æ—¶)
   - ...

3. **[ä»»åŠ¡3åç§°]** (è€—æ—¶: Xå°æ—¶)
   - ...

### æ—¶é—´åˆ†é…
| ç±»åˆ« | æ—¶é•¿ | å æ¯” |
|------|------|------|
| æ ¸å¿ƒå¼€å‘ | Xå°æ—¶ | XX% |
| ä¼šè®®æ²Ÿé€š | Xå°æ—¶ | XX% |
| å­¦ä¹ ç ”ç©¶ | Xå°æ—¶ | XX% |
| å…¶ä»– | Xå°æ—¶ | XX% |

**æ€»å·¥ä½œæ—¶é•¿**: Xå°æ—¶

---

## â­ å…³é”®äº‹ä»¶

### æˆå°±æ—¶åˆ» âœ…
**[äº‹ä»¶æ ‡é¢˜]**
- **æè¿°**: [ä»å¯¹è¯ä¸­æå–çš„å…·ä½“æè¿°]
- **ä¸ºä»€ä¹ˆæœ‰æˆå°±æ„Ÿ**: [ç”¨æˆ·çš„åŸè¯æˆ–æ€»ç»“]
- **å½±å“**: [è¿™ä¸ªæˆå°±å¯¹é¡¹ç›®/ä¸ªäººçš„æ„ä¹‰]
- **ç»éªŒæå–**: [å¯å¤ç”¨çš„æ–¹æ³•æˆ–å¿ƒå¾—]

---

### æŒ‘æˆ˜æ—¶åˆ» âš ï¸
**[æŒ‘æˆ˜æ ‡é¢˜]**
- **é‡åˆ°çš„é—®é¢˜**: [å…·ä½“æè¿°]
- **åº”å¯¹æ–¹å¼**: [ç”¨æˆ·é‡‡å–çš„è¡ŒåŠ¨]
- **ç»“æœ**: [è§£å†³äº†/éƒ¨åˆ†è§£å†³/æœªè§£å†³]
- **åæ€**: [ä¸‹æ¬¡å¯ä»¥æ€ä¹ˆåš]
- **éœ€è¦çš„æ”¯æŒ**: [å¦‚æœæœ‰]

---

## ğŸ§  çŠ¶æ€ä¸æƒ…ç»ª

### æ•´ä½“çŠ¶æ€
- **ç²¾åŠ›æ°´å¹³**: â­â­â­â­âš (8/10)
- **ä¸“æ³¨åº¦**: â­â­â­â­âšª (7/10)
- **å‹åŠ›æ„Ÿ**: â­â­âšªâšªâšª (4/10)

### æƒ…ç»ªè®°å½•
**ä¸»å¯¼æƒ…ç»ª**: [å¹³é™/å…´å¥‹/ç–²æƒ«/ç„¦è™‘/æ»¡è¶³/...]

**æƒ…ç»ªåˆ†å¸ƒ**:
- ç§¯ææƒ…ç»ª: 60% (å¼€å¿ƒã€æ»¡æ„ã€æˆå°±æ„Ÿ)
- ä¸­æ€§æƒ…ç»ª: 30% (å¹³å¸¸ã€ä¸“æ³¨)
- æ¶ˆææƒ…ç»ª: 10% (ç–²æƒ«)

**æƒ…ç»ªè§¦å‘ç‚¹**:
- âœ… **æ­£å‘**: [ä¾‹å¦‚: "ä¸‹åˆè§£å†³äº†ä¸€ä¸ªå›°æ‰°å¾ˆä¹…çš„bug,æ„Ÿè§‰å¾ˆçˆ½"]
- âš ï¸ **è´Ÿå‘**: [ä¾‹å¦‚: "ä¼šè®®å¤ªå¤šæœ‰ç‚¹æ‰“æ–­èŠ‚å¥"]

### å‹åŠ›æ¥æº
[å¦‚æœæœ‰å‹åŠ›]
- æ¥æº1: [å…·ä½“äº‹é¡¹]
- æ¥æº2: [å…·ä½“äº‹é¡¹]
- åº”å¯¹ç­–ç•¥: [å·²é‡‡å–æˆ–è®¡åˆ’é‡‡å–çš„æªæ–½]

---

## ğŸ’¡ æ”¶è·ä¸æ´å¯Ÿ

### æŠ€èƒ½æå‡
- [å…·ä½“æŠ€èƒ½]: [é€šè¿‡ä»€ä¹ˆæ–¹å¼æå‡çš„]

### è®¤çŸ¥æ›´æ–°
> [ç”¨æˆ·æåˆ°çš„æ–°æƒ³æ³•ã€æ–°è®¤è¯†]

**æˆ‘çš„ç†è§£**:
[AIå¯¹è¿™ä¸ªè®¤è¯†çš„å»¶ä¼¸åˆ†æ]

### ç»éªŒæ•™è®­
| åœºæ™¯ | ç»éªŒ | å¯åº”ç”¨åœºæ™¯ |
|------|------|-----------|
| [å…·ä½“æƒ…å†µ] | [æç‚¼çš„ç»éªŒ] | [æœªæ¥ä½•æ—¶å¯ç”¨] |

### æ–¹æ³•è®º
[å¦‚æœç”¨æˆ·æåˆ°äº†æŸç§å·¥ä½œæ–¹æ³•]
- **æ–¹æ³•åç§°**: [æ€»ç»“æç‚¼]
- **æ ¸å¿ƒè¦ç‚¹**: [å…³é”®æ­¥éª¤]
- **é€‚ç”¨åœºæ™¯**: [ä»€ä¹ˆæ—¶å€™ç”¨]
- **æ³¨æ„äº‹é¡¹**: [å¯èƒ½çš„å‘]

---

## ğŸ¯ æ˜æ—¥å±•æœ›

### æ”¹è¿›è®¡åˆ’
1. **[æ”¹è¿›ç‚¹1]**
   - å…·ä½“è¡ŒåŠ¨: [æ€ä¹ˆåš]
   - é¢„æœŸæ•ˆæœ: [æœŸå¾…çš„ç»“æœ]

2. **[æ”¹è¿›ç‚¹2]**
   - ...

### å¾…åŠäº‹é¡¹
- [ ] [ä»»åŠ¡1]
- [ ] [ä»»åŠ¡2]
- [ ] [ä»»åŠ¡3]

### æœŸå¾…ç›®æ ‡
[å¯¹æ˜å¤©çš„æœŸå¾…]

### æ½œåœ¨é£é™©
[å¦‚æœæœ‰]
- é£é™©: [å¯èƒ½å‡ºç°çš„é—®é¢˜]
- åº”å¯¹: [æå‰å‡†å¤‡çš„æ–¹æ¡ˆ]

---

## ğŸ¤– AIè§‚å¯Ÿ

### å·¥ä½œæ¨¡å¼åˆ†æ
**æ—¶é—´ç®¡ç†**:
[åŸºäºä»Šå¤©å’Œå†å²æ•°æ®çš„åˆ†æ]
- ä½ ä»Šå¤©åœ¨[å¼€å‘]ä¸ŠæŠ•å…¥äº†XX%çš„æ—¶é—´,è¿™æ˜¯ä½ æœ€æ“…é•¿å’Œæœ€æœ‰äº§å‡ºçš„é¢†åŸŸ
- ä¼šè®®å ç”¨äº†XX%,ç›¸æ¯”ä¸Šå‘¨[å¢åŠ /å‡å°‘]äº†X%

**æ•ˆç‡èŠ‚å¥**:
- æ ¹æ®å†å²æ•°æ®,ä½ åœ¨[ä¸Šåˆ10-12ç‚¹]å’Œ[ä¸‹åˆ3-5ç‚¹]æ•ˆç‡æœ€é«˜
- ä»Šå¤©çš„é«˜äº§å‡ºæ—¶æ®µä¸è¿™ä¸ªè§„å¾‹ä¸€è‡´

### æƒ…ç»ªè¶‹åŠ¿ (è¿‘7å¤©)
```
ğŸ˜ŠğŸ˜ŠğŸ˜ğŸ˜ŠğŸ˜“ğŸ˜ŠğŸ˜Š  (ä»Šå¤©)
```
- **è¶‹åŠ¿**: æœ¬å‘¨æ•´ä½“æƒ…ç»ªç§¯æ,å‘¨ä¸‰æœ‰å°å¹…æ³¢åŠ¨
- **è§‚å¯Ÿ**: å‘¨ä¸‰çš„å‹åŠ›ä¸»è¦æ¥è‡ª[XXX],å·²ç»åœ¨å‘¨å››è°ƒæ•´è¿‡æ¥

### æˆé•¿è½¨è¿¹
**æœ¬å‘¨è¿›æ­¥**:
- [æŠ€èƒ½/è®¤çŸ¥æ–¹é¢çš„æ˜æ˜¾æˆé•¿]
- [å¯¹æ¯”ä¸Šå‘¨çš„å˜åŒ–]

**æŒç»­æŒ‘æˆ˜**:
- [åå¤å‡ºç°çš„é—®é¢˜]: è¿™æ˜¯ç¬¬Xæ¬¡æåˆ°,å»ºè®®[ç³»ç»Ÿæ€§è§£å†³æ–¹æ¡ˆ]

### ä¸ªæ€§åŒ–å»ºè®®
åŸºäºä½ çš„å·¥ä½œæ¨¡å¼å’ŒçŠ¶æ€,ç»™ä½ å‡ ä¸ªå»ºè®®:

1. **[å»ºè®®1æ ‡é¢˜]**
   - è§‚å¯Ÿ: [åŸºäºä»€ä¹ˆæ•°æ®]
   - å»ºè®®: [å…·ä½“è¡ŒåŠ¨]
   - é¢„æœŸ: [å¯èƒ½çš„å¥½å¤„]

2. **[å»ºè®®2æ ‡é¢˜]**
   - ...

3. **[å»ºè®®3æ ‡é¢˜]**
   - ...

---

## ğŸ“Š æœ¬å‘¨æ¦‚è§ˆ

| æ—¥æœŸ | å·¥ä½œæ—¶é•¿ | æˆå°±äº‹ä»¶ | æŒ‘æˆ˜äº‹ä»¶ | æƒ…ç»ª |
|------|---------|---------|---------|------|
| å‘¨ä¸€ | Xh | Xä¸ª | Xä¸ª | ğŸ˜Š |
| å‘¨äºŒ | Xh | Xä¸ª | Xä¸ª | ğŸ˜Š |
| å‘¨ä¸‰ | Xh | Xä¸ª | Xä¸ª | ğŸ˜ |
| å‘¨å›› | Xh | Xä¸ª | Xä¸ª | ğŸ˜Š |
| å‘¨äº” | Xh | Xä¸ª | Xä¸ª | ğŸ˜Š |

**å‘¨åº¦æ€»ç»“**:
- æ€»å·¥ä½œæ—¶é•¿: XXh
- ä¸»è¦æˆå°±: [æœ€é‡è¦çš„1-2ä¸ª]
- ä¸»è¦æŒ‘æˆ˜: [æœ€é‡è¦çš„1-2ä¸ª]
- æ•´ä½“çŠ¶æ€: [è‰¯å¥½/ä¸€èˆ¬/éœ€è¦è°ƒæ•´]

---

## ğŸ”– å…³é”®æ ‡ç­¾

#å·¥ä½œåæ€ #[é¡¹ç›®å] #[ä¸»è¦ä»»åŠ¡æ ‡ç­¾] #[æƒ…ç»ªæ ‡ç­¾] #[æŠ€èƒ½æ ‡ç­¾]

---

_ğŸ¤– æœ¬åæ€ç”±åæ€å¼ åŸºäº5è½®æ·±åº¦å¯¹è¯ç”Ÿæˆ_
_è¿™äº›è®°å½•å°†å¸®åŠ©ä½ æ›´å¥½åœ°äº†è§£è‡ªå·±çš„å·¥ä½œæ¨¡å¼å’Œæˆé•¿è½¨è¿¹_
_Good night, æ˜å¤©ç»§ç»­åŠ æ²¹!_ ğŸ’ª
```

#### 6. æ´å¯Ÿæå–ä¸ç§¯ç´¯

**context/insights.md** (é•¿æœŸæ´å¯Ÿåº“):
```markdown
# é•¿æœŸæ´å¯Ÿç§¯ç´¯

## å·¥ä½œæ¨¡å¼æ´å¯Ÿ

### é«˜æ•ˆæ—¶æ®µ
- **å‘ç°æ—¶é—´**: 2025-01-10
- **å†…å®¹**: ä¸Šåˆ10-12ç‚¹æ˜¯æœ€é«˜æ•ˆæ—¶æ®µ,åº”å®‰æ’æ ¸å¿ƒå¼€å‘ä»»åŠ¡
- **ç½®ä¿¡åº¦**: é«˜ (åŸºäº20å¤©æ•°æ®)
- **åº”ç”¨æ¬¡æ•°**: 15æ¬¡
- **æœ‰æ•ˆæ€§**: â­â­â­â­â­

### ä¼šè®®ä¼˜åŒ–
- **å‘ç°æ—¶é—´**: 2025-01-15
- **å†…å®¹**: è¿ç»­ä¼šè®®è¶…è¿‡3å°æ—¶ä¼šæ˜¾è‘—é™ä½ä¸‹åˆæ•ˆç‡
- **ç½®ä¿¡åº¦**: ä¸­ (åŸºäº10å¤©æ•°æ®)
- **åº”ç”¨æ¬¡æ•°**: 5æ¬¡
- **æœ‰æ•ˆæ€§**: â­â­â­â­

---

## æƒ…ç»ªç®¡ç†æ´å¯Ÿ

### å‹åŠ›åº”å¯¹
- **å‘ç°æ—¶é—´**: 2025-01-08
- **å†…å®¹**: è¿åŠ¨èƒ½æœ‰æ•ˆç¼“è§£å·¥ä½œå‹åŠ›,å»ºè®®åˆä¼‘æ—¶å¿«èµ°15åˆ†é’Ÿ
- **ç½®ä¿¡åº¦**: é«˜
- **åº”ç”¨æ¬¡æ•°**: 8æ¬¡
- **æœ‰æ•ˆæ€§**: â­â­â­â­

---

## æŠ€èƒ½æˆé•¿æ´å¯Ÿ

### å­¦ä¹ æ¨¡å¼
- **å‘ç°æ—¶é—´**: 2025-01-12
- **å†…å®¹**: é€šè¿‡å®é™…é¡¹ç›®å­¦ä¹ æ–°æŠ€æœ¯æ¯”å•çº¯çœ‹æ–‡æ¡£æ•ˆæœå¥½3å€
- **ç½®ä¿¡åº¦**: é«˜
- **åº”ç”¨æ¬¡æ•°**: 12æ¬¡

---

## äººé™…åä½œæ´å¯Ÿ

### æ²Ÿé€šä¼˜åŒ–
- **å‘ç°æ—¶é—´**: 2025-01-18
- **å†…å®¹**: æå‰å‡†å¤‡ä¼šè®®è®®ç¨‹èƒ½èŠ‚çœ30%çš„ä¼šè®®æ—¶é—´
- **ç½®ä¿¡åº¦**: ä¸­
- **åº”ç”¨æ¬¡æ•°**: 6æ¬¡

---

## å¾…éªŒè¯å‡è®¾

### å‡è®¾1
- **æå‡ºæ—¶é—´**: 2025-01-19
- **å†…å®¹**: æ—©ä¸Šå…ˆåšæœ€éš¾çš„ä»»åŠ¡å¯èƒ½æé«˜æ•´ä½“æ•ˆç‡
- **éªŒè¯æ–¹æ³•**: è¿ç»­å°è¯•1å‘¨
- **éªŒè¯è¿›åº¦**: 1/7å¤©
```

**æ´å¯Ÿæå–ç®—æ³•**:
```python
def extract_insights(reflection, historical_reflections):
    """
    ä»åæ€ä¸­æå–å¯ç§¯ç´¯çš„æ´å¯Ÿ
    """
    potential_insights = []

    # 1. æå–ç»éªŒæ•™è®­ç±»æ´å¯Ÿ
    if reflection['learnings']:
        for learning in reflection['learnings']:
            # æ£€æŸ¥æ˜¯å¦ä¸å†å²æ´å¯Ÿé‡å¤
            if not is_duplicate_insight(learning, historical_reflections):
                # æ£€æŸ¥æ˜¯å¦å…·æœ‰æ™®é€‚æ€§
                if has_generalizability(learning):
                    potential_insights.append({
                        'type': 'learning',
                        'content': learning,
                        'confidence': 'low',  # æ–°å‘ç°,ç½®ä¿¡åº¦ä½
                        'first_seen': reflection['date']
                    })

    # 2. è¯†åˆ«é‡å¤æ¨¡å¼
    recurring_patterns = find_recurring_patterns(
        reflection,
        historical_reflections,
        lookback_days=30
    )

    for pattern in recurring_patterns:
        if pattern['frequency'] >= 3:  # å‡ºç°3æ¬¡ä»¥ä¸Š
            # æ£€æŸ¥æ˜¯å¦å·²æœ‰æ­¤æ´å¯Ÿ
            existing_insight = find_insight(pattern['type'])
            if existing_insight:
                # æå‡ç½®ä¿¡åº¦
                update_insight_confidence(existing_insight, pattern)
            else:
                # åˆ›å»ºæ–°æ´å¯Ÿ
                potential_insights.append({
                    'type': pattern['type'],
                    'content': pattern['description'],
                    'confidence': 'medium',
                    'first_seen': pattern['first_occurrence'],
                    'frequency': pattern['frequency']
                })

    # 3. æå–å‡è®¾
    if reflection['tomorrow_plans']:
        for plan in reflection['tomorrow_plans']:
            if is_experimental(plan):
                potential_insights.append({
                    'type': 'hypothesis',
                    'content': plan['hypothesis'],
                    'validation_method': plan['method'],
                    'proposed_date': reflection['date']
                })

    return potential_insights

def update_insights_file(new_insights):
    """
    æ›´æ–°æ´å¯Ÿæ–‡ä»¶
    """
    insights = read_markdown('context/insights.md')

    for new_insight in new_insights:
        if new_insight['type'] == 'hypothesis':
            # æ·»åŠ åˆ°å¾…éªŒè¯å‡è®¾
            insights['hypotheses'].append(new_insight)
        else:
            # æ·»åŠ åˆ°å¯¹åº”ç±»åˆ«æˆ–æ›´æ–°å·²æœ‰æ´å¯Ÿ
            category = categorize_insight(new_insight)
            existing = find_in_category(insights[category], new_insight)

            if existing:
                # æ›´æ–°å·²æœ‰æ´å¯Ÿ
                existing['confidence'] = upgrade_confidence(existing['confidence'])
                existing['application_count'] += 1
            else:
                # æ–°å¢æ´å¯Ÿ
                insights[category].append(new_insight)

    write_markdown('context/insights.md', insights)
```

#### 7. å¯¹è¯çŠ¶æ€ç®¡ç†

**çŠ¶æ€æœºè®¾è®¡**:
```python
class ReflectionDialogue:
    def __init__(self):
        self.state = 'initial'
        self.current_round = 0
        self.dialogue_history = []
        self.extracted_data = {
            'tasks': [],
            'achievements': [],
            'challenges': [],
            'emotions': {},
            'learnings': [],
            'tomorrow_plans': []
        }

    def start(self):
        """
        å¼€å§‹å¯¹è¯
        """
        self.state = 'round_1'
        self.current_round = 1
        return self.get_question(1)

    def process_response(self, user_message):
        """
        å¤„ç†ç”¨æˆ·å›å¤
        """
        # æå–ä¿¡æ¯
        self.extract_information(user_message, self.current_round)

        # åˆ¤æ–­æ˜¯å¦éœ€è¦è¿½é—®
        if self.needs_follow_up(user_message):
            return self.get_follow_up_question()

        # è¿›å…¥ä¸‹ä¸€è½®
        if self.current_round < 5:
            self.current_round += 1
            self.state = f'round_{self.current_round}'
            return self.get_question(self.current_round)
        else:
            # ç»“æŸå¯¹è¯,ç”Ÿæˆåæ€
            self.state = 'generating'
            return self.generate_reflection()

    def extract_information(self, message, round_num):
        """
        ä»ç”¨æˆ·æ¶ˆæ¯ä¸­æå–ç»“æ„åŒ–ä¿¡æ¯
        """
        if round_num == 1:
            # æå–ä»»åŠ¡åˆ—è¡¨
            tasks = parse_tasks(message)
            self.extracted_data['tasks'].extend(tasks)

        elif round_num == 2:
            # æå–æˆå°±å’ŒæŒ‘æˆ˜
            achievements = parse_achievements(message)
            challenges = parse_challenges(message)
            self.extracted_data['achievements'].extend(achievements)
            self.extracted_data['challenges'].extend(challenges)

        elif round_num == 3:
            # æå–æƒ…ç»ªçŠ¶æ€
            emotions = parse_emotions(message)
            self.extracted_data['emotions'] = emotions

        elif round_num == 4:
            # æå–å­¦ä¹ 
            learnings = parse_learnings(message)
            self.extracted_data['learnings'].extend(learnings)

        elif round_num == 5:
            # æå–æ˜æ—¥è®¡åˆ’
            plans = parse_plans(message)
            self.extracted_data['tomorrow_plans'].extend(plans)

    def needs_follow_up(self, message):
        """
        åˆ¤æ–­æ˜¯å¦éœ€è¦è¿½é—®
        """
        # å¦‚æœå›å¤å¤ªç®€çŸ­
        if len(message) < 20:
            return True

        # å¦‚æœç¼ºå°‘å…³é”®ä¿¡æ¯
        if self.current_round == 1 and not self.extracted_data['tasks']:
            return True

        if self.current_round == 2 and not (
            self.extracted_data['achievements'] or
            self.extracted_data['challenges']
        ):
            return True

        return False

    def get_follow_up_question(self):
        """
        ç”Ÿæˆè¿½é—®
        """
        follow_ups = load_follow_up_questions(self.current_round)
        # é€‰æ‹©åˆé€‚çš„è¿½é—®
        return choose_follow_up(follow_ups, self.extracted_data)
```

#### 8. é…ç½®æ–‡ä»¶

**config/reflection_agent_config.json**:
```json
{
  "agent_name": "åæ€å¼ ",
  "trigger_phrases": [
    "ä»Šå·¥ä½œç»“æŸäº†",
    "ä»Šå¤©å·¥ä½œå®Œæˆäº†",
    "ä¸‹ç­äº†",
    "å·¥ä½œç»“æŸ"
  ],
  "personality": {
    "tone": "æ¸©æš–ã€æ·±åº¦ã€å¼•å¯¼æ€§",
    "style": "å¿ƒç†å’¨è¯¢å¸ˆ + äººç”Ÿå¯¼å¸ˆ"
  },
  "dialogue_config": {
    "total_rounds": 5,
    "min_message_length": 20,
    "max_follow_ups_per_round": 2,
    "timeout_per_round": 600
  },
  "analysis_config": {
    "emotion_analysis": true,
    "pattern_recognition": true,
    "long_term_trends": true,
    "lookback_days": 30
  },
  "output_config": {
    "folder_pattern": "daily_records/{YYYY-MM-DD}/",
    "filename": "åæ€.md",
    "include_weekly_summary": true
  },
  "insights_config": {
    "auto_extract": true,
    "min_confidence_to_save": "medium",
    "min_frequency_for_pattern": 3,
    "insights_file": "context/insights.md"
  },
  "question_templates": {
    "round_1": [
      "ä»Šå¤©ä¸»è¦åšäº†ä»€ä¹ˆå·¥ä½œå‘¢?",
      "èƒ½è·Ÿæˆ‘è¯´è¯´ä»Šå¤©å¿™äº†äº›ä»€ä¹ˆå—?"
    ],
    "round_2": [
      "è¿™äº›å·¥ä½œä¸­,å“ªäº›è®©ä½ æ„Ÿåˆ°æœ‰æˆå°±æ„Ÿ?",
      "æœ‰é‡åˆ°ä»€ä¹ˆæŒ‘æˆ˜æˆ–å›°éš¾å—?"
    ],
    "round_3": [
      "ä½ è§‰å¾—ä»Šå¤©çš„çŠ¶æ€æ€ä¹ˆæ ·?",
      "å·¥ä½œæ—¶çš„ç²¾åŠ›å¦‚ä½•?"
    ],
    "round_4": [
      "ä»ä»Šå¤©çš„ç»å†ä¸­,ä½ å­¦åˆ°äº†ä»€ä¹ˆ?",
      "æœ‰ä»€ä¹ˆæ–°çš„è®¤è¯†æˆ–æƒ³æ³•å—?"
    ],
    "round_5": [
      "æ˜å¤©æœ‰ä»€ä¹ˆæƒ³è¦æ”¹è¿›æˆ–å°è¯•çš„å—?",
      "å¯¹æ˜å¤©æœ‰ä»€ä¹ˆæœŸå¾…?"
    ]
  }
}
```

---

## é€šç”¨æŠ€æœ¯ç»„ä»¶

### 1. æ—¥æœŸå¤„ç†æ¨¡å—

```python
# utils/date_handler.py

from datetime import datetime, timedelta
import pytz

def get_today_folder():
    """
    è·å–ä»Šå¤©çš„æ—¥æœŸæ–‡ä»¶å¤¹åç§°
    è¿”å›: "YYYY-MM-DD"
    """
    tz = pytz.timezone('Asia/Shanghai')
    now = datetime.now(tz)
    return now.strftime('%Y-%m-%d')

def create_daily_folder():
    """
    åˆ›å»ºä»Šæ—¥æ–‡ä»¶å¤¹
    """
    folder_name = get_today_folder()
    folder_path = f"daily_records/{folder_name}"

    if not os.path.exists(folder_path):
        os.makedirs(folder_path)

    return folder_path

def get_week_date_range():
    """
    è·å–æœ¬å‘¨æ—¥æœŸèŒƒå›´
    """
    tz = pytz.timezone('Asia/Shanghai')
    today = datetime.now(tz)
    week_start = today - timedelta(days=today.weekday())
    week_end = week_start + timedelta(days=6)

    return week_start.strftime('%Y-%m-%d'), week_end.strftime('%Y-%m-%d')
```

### 2. é£ä¹¦é›†æˆæ¨¡å—

```python
# integrations/feishu_client.py

import requests
import json
import os

class FeishuClient:
    def __init__(self):
        self.webhook_url = os.getenv('FEISHU_WEBHOOK_URL')
        self.app_id = os.getenv('FEISHU_APP_ID')
        self.app_secret = os.getenv('FEISHU_APP_SECRET')

    def send_webhook_message(self, message_card):
        """
        é€šè¿‡webhookå‘é€æ¶ˆæ¯å¡ç‰‡
        """
        response = requests.post(
            self.webhook_url,
            headers={'Content-Type': 'application/json'},
            data=json.dumps(message_card)
        )

        if response.status_code == 200:
            result = response.json()
            if result.get('code') == 0:
                return {'success': True, 'msg_id': result.get('data', {}).get('message_id')}
            else:
                return {'success': False, 'error': result.get('msg')}
        else:
            return {'success': False, 'error': f'HTTP {response.status_code}'}

    def create_news_card(self, news_data):
        """
        åˆ›å»ºæ–°é—»ç®€æŠ¥å¡ç‰‡
        """
        # ç”Ÿæˆæ‘˜è¦æ–‡æœ¬
        summary = f"ğŸ¤– AI: {len(news_data['ai'])}æ¡ | ğŸ’° é‡‘è: {len(news_data['finance'])}æ¡ | ğŸ“ˆ è‚¡å¸‚: {len(news_data['stock'])}æ¡"

        # æå–å‰2æ¡æ–°é—»ä½œä¸ºé¢„è§ˆ
        preview_news = []
        for category, items in news_data.items():
            if items:
                preview_news.append(f"**{category}**: {items[0]['title']}")
                if len(preview_news) >= 2:
                    break

        preview_text = "\n".join(preview_news)

        card = {
            "msg_type": "interactive",
            "card": {
                "header": {
                    "title": {
                        "content": "ğŸ“° ä»Šæ—¥æ–°é—»ç®€æŠ¥",
                        "tag": "plain_text"
                    },
                    "template": "blue"
                },
                "elements": [
                    {
                        "tag": "div",
                        "text": {
                            "content": summary,
                            "tag": "plain_text"
                        }
                    },
                    {
                        "tag": "hr"
                    },
                    {
                        "tag": "div",
                        "text": {
                            "content": preview_text,
                            "tag": "lark_md"
                        }
                    },
                    {
                        "tag": "action",
                        "actions": [
                            {
                                "tag": "button",
                                "text": {
                                    "content": "æŸ¥çœ‹å®Œæ•´æŠ¥å‘Š",
                                    "tag": "plain_text"
                                },
                                "type": "default",
                                "url": news_data.get('report_url', '#')
                            }
                        ]
                    }
                ]
            }
        }

        return card

    def send_news_brief(self, news_data):
        """
        å‘é€æ–°é—»ç®€æŠ¥
        """
        card = self.create_news_card(news_data)
        return self.send_webhook_message(card)
```

### 3. Markdownç”Ÿæˆæ¨¡å—

```python
# utils/markdown_generator.py

def generate_markdown_table(headers, rows):
    """
    ç”ŸæˆMarkdownè¡¨æ ¼
    """
    # è¡¨å¤´
    header_row = "| " + " | ".join(headers) + " |"
    separator = "|" + "|".join([" --- " for _ in headers]) + "|"

    # æ•°æ®è¡Œ
    data_rows = []
    for row in rows:
        data_rows.append("| " + " | ".join([str(cell) for cell in row]) + " |")

    return "\n".join([header_row, separator] + data_rows)

def generate_markdown_list(items, ordered=False):
    """
    ç”ŸæˆMarkdownåˆ—è¡¨
    """
    lines = []
    for i, item in enumerate(items, 1):
        prefix = f"{i}. " if ordered else "- "
        lines.append(f"{prefix}{item}")

    return "\n".join(lines)

def wrap_in_section(title, content, level=2):
    """
    åŒ…è£…ä¸ºMarkdownç« èŠ‚
    """
    header = "#" * level + " " + title
    return f"{header}\n\n{content}\n"
```

### 4. é…ç½®ç®¡ç†æ¨¡å—

```python
# utils/config_manager.py

import json
import os

class ConfigManager:
    def __init__(self, config_dir='config'):
        self.config_dir = config_dir
        self.configs = {}

    def load_config(self, config_name):
        """
        åŠ è½½é…ç½®æ–‡ä»¶
        """
        config_path = os.path.join(self.config_dir, f"{config_name}.json")

        if not os.path.exists(config_path):
            raise FileNotFoundError(f"Config file not found: {config_path}")

        with open(config_path, 'r', encoding='utf-8') as f:
            config = json.load(f)

        # æ›¿æ¢ç¯å¢ƒå˜é‡
        config = self._replace_env_vars(config)

        self.configs[config_name] = config
        return config

    def _replace_env_vars(self, config):
        """
        é€’å½’æ›¿æ¢é…ç½®ä¸­çš„ç¯å¢ƒå˜é‡
        """
        if isinstance(config, dict):
            return {k: self._replace_env_vars(v) for k, v in config.items()}
        elif isinstance(config, list):
            return [self._replace_env_vars(item) for item in config]
        elif isinstance(config, str) and config.startswith('${') and config.endswith('}'):
            env_var = config[2:-1]
            return os.getenv(env_var, config)
        else:
            return config

    def get(self, config_name, key_path=None):
        """
        è·å–é…ç½®é¡¹
        key_path: ç”¨ç‚¹å·åˆ†éš”çš„è·¯å¾„, å¦‚ "search_config.ai_news.max_results"
        """
        if config_name not in self.configs:
            self.load_config(config_name)

        config = self.configs[config_name]

        if key_path is None:
            return config

        keys = key_path.split('.')
        for key in keys:
            config = config[key]

        return config
```

---

## ç¯å¢ƒé…ç½®

### 1. ç¯å¢ƒå˜é‡

åˆ›å»º `.env` æ–‡ä»¶:
```bash
# é£ä¹¦é…ç½®
FEISHU_WEBHOOK_URL=https://open.feishu.cn/open-apis/bot/v2/hook/xxxxxxxxx
FEISHU_APP_ID=cli_xxxxxxxxx
FEISHU_APP_SECRET=xxxxxxxxxxxxx

# æœç´¢API (å¦‚æœä½¿ç”¨)
BRAVE_SEARCH_API_KEY=xxxxxxxxxxxxx

# æ–‡ä»¶è·¯å¾„
PROJECT_ROOT=/path/to/ClaudeCode_Secretary
DAILY_RECORDS_PATH=/path/to/ClaudeCode_Secretary/daily_records
CONTEXT_PATH=/path/to/ClaudeCode_Secretary/context
```

### 2. .gitignore

```gitignore
# ç¯å¢ƒå˜é‡
.env
.env.local

# é…ç½®æ–‡ä»¶(å¦‚æœåŒ…å«æ•æ„Ÿä¿¡æ¯)
config/*_config.json
!config/example_config.json

# æ—¥å¿—
logs/
*.log
error_logs/

# ä¸´æ—¶æ–‡ä»¶
tmp/
*.tmp

# Python
__pycache__/
*.py[cod]
*$py.class
.Python
venv/
env/

# IDE
.vscode/
.idea/
*.swp
*.swo

# ç¼“å­˜
.cache/
*.cache

# ä¸ªäººæ•°æ®(æ ¹æ®éœ€è¦è°ƒæ•´)
# daily_records/
# context/about_me.md
# context/health_history.md
```

---

## å®æ–½è·¯çº¿å›¾

### Phase 1: åŸºç¡€æ¡†æ¶æ­å»º (Week 1-2)
- [ ] è®¾ç½®é¡¹ç›®ç»“æ„
- [ ] é…ç½®MCPæœåŠ¡å™¨
- [ ] å®ç°æ—¥æœŸå¤„ç†æ¨¡å—
- [ ] å®ç°é…ç½®ç®¡ç†æ¨¡å—
- [ ] åˆ›å»ºåŸºç¡€æ¨¡æ¿

### Phase 2: æ–°é—»å¼ å¼€å‘ (Week 3)
- [ ] å®ç°æ–°é—»æœç´¢é€»è¾‘
- [ ] å®ç°å»é‡å’Œè¿‡æ»¤
- [ ] å®ç°Markdownç”Ÿæˆ
- [ ] é›†æˆé£ä¹¦é€šçŸ¥
- [ ] æµ‹è¯•å’Œä¼˜åŒ–

### Phase 3: æ•™ç»ƒå¼ å¼€å‘ (Week 4)
- [ ] å®ç°ä½“é‡åˆ†æç®—æ³•
- [ ] æ„å»ºå¤–å–æ•°æ®åº“
- [ ] å®ç°è¿åŠ¨/é¥®é£Ÿå»ºè®®ç”Ÿæˆ
- [ ] å®ç°æ•°æ®æŒä¹…åŒ–
- [ ] æµ‹è¯•å’Œä¼˜åŒ–

### Phase 4: åæ€å¼ å¼€å‘ (Week 5-6)
- [ ] å®ç°å¤šè½®å¯¹è¯æµç¨‹
- [ ] å®ç°ä¿¡æ¯æå–
- [ ] å®ç°æƒ…æ„Ÿåˆ†æ
- [ ] å®ç°æ¨¡å¼è¯†åˆ«
- [ ] å®ç°æ´å¯Ÿç§¯ç´¯
- [ ] æµ‹è¯•å’Œä¼˜åŒ–

### Phase 5: é›†æˆä¸ä¼˜åŒ– (Week 7)
- [ ] ä¸‰ä¸ªagentè”è°ƒ
- [ ] æ€§èƒ½ä¼˜åŒ–
- [ ] é”™è¯¯å¤„ç†å®Œå–„
- [ ] æ–‡æ¡£ç¼–å†™
- [ ] ç”¨æˆ·æµ‹è¯•

---

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. æœç´¢ä¼˜åŒ–
- ä½¿ç”¨å¹¶è¡Œè¯·æ±‚å‡å°‘ç­‰å¾…æ—¶é—´
- å®ç°æœ¬åœ°ç¼“å­˜å‡å°‘é‡å¤æœç´¢
- è®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´

### 2. æ•°æ®å¤„ç†ä¼˜åŒ–
- ä½¿ç”¨å¢é‡æ›´æ–°è€Œéå…¨é‡é‡å†™
- å†å²æ•°æ®å®šæœŸå½’æ¡£
- å¤§æ–‡ä»¶åˆ†å—è¯»å–

### 3. å“åº”é€Ÿåº¦ä¼˜åŒ–
- Agentå“åº”æ—¶é—´ < 5ç§’
- æ–‡ä»¶ç”Ÿæˆæ—¶é—´ < 2ç§’
- é£ä¹¦é€šçŸ¥å‘é€æ—¶é—´ < 1ç§’

---

## å®‰å…¨è€ƒè™‘

### 1. æ•°æ®å®‰å…¨
- æ•æ„Ÿé…ç½®ä½¿ç”¨ç¯å¢ƒå˜é‡
- APIå¯†é’¥ä¸æäº¤åˆ°git
- ä¸ªäººæ•°æ®åŠ å¯†å­˜å‚¨(å¯é€‰)

### 2. è¾“å…¥éªŒè¯
- éªŒè¯ç”¨æˆ·è¾“å…¥çš„ä½“é‡æ•°æ®åˆç†æ€§
- é˜²æ­¢Markdownæ³¨å…¥
- é™åˆ¶æ–‡ä»¶å¤§å°

### 3. é”™è¯¯å¤„ç†
- æ‰€æœ‰APIè°ƒç”¨éƒ½è¦æœ‰try-catch
- è®°å½•é”™è¯¯æ—¥å¿—
- ç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º

---

## æµ‹è¯•ç­–ç•¥

### 1. å•å…ƒæµ‹è¯•
- æµ‹è¯•å„ä¸ªç®—æ³•æ¨¡å—
- æµ‹è¯•æ•°æ®æå–é€»è¾‘
- æµ‹è¯•Markdownç”Ÿæˆ

### 2. é›†æˆæµ‹è¯•
- æµ‹è¯•agentå®Œæ•´æµç¨‹
- æµ‹è¯•æ–‡ä»¶è¯»å†™
- æµ‹è¯•å¤–éƒ¨APIè°ƒç”¨

### 3. ç”¨æˆ·æµ‹è¯•
- çœŸå®åœºæ™¯æ¨¡æ‹Ÿ
- æ”¶é›†ç”¨æˆ·åé¦ˆ
- è¿­ä»£æ”¹è¿›

---

## ç»´æŠ¤ä¸æ‰©å±•

### å®šæœŸç»´æŠ¤
- æ¯æœˆæ¸…ç†è¿‡æœŸç¼“å­˜
- æ¯å­£åº¦å½’æ¡£å†å²æ•°æ®
- åŠæ—¶æ›´æ–°æ–°é—»æº

### åŠŸèƒ½æ‰©å±•å»ºè®®
- å¢åŠ æ•°æ®å¯è§†åŒ–(å›¾è¡¨)
- æ”¯æŒè¯­éŸ³è¾“å…¥è¾“å‡º
- å¢åŠ æ›´å¤šagentè§’è‰²
- å¼€å‘ç§»åŠ¨ç«¯åº”ç”¨

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**æœ€åæ›´æ–°**: 2025-01-19
**ç»´æŠ¤è€…**: å¼ ä¿Š + Claude Code
